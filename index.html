<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title>Roaring 20</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript">
    $().ready(function(){
        $.ajax({
            url:'http://search.twitter.com/search.json?q=%23fun&rpp=10&include_entities=true&callback=?',
            //url:'test.json',
            dataType:'json',
            crossDomain:true,
            success:function(data){
                $.each(data, function(index, results) {
                    var r = results;
                    if(typeof r=='object'){
                        $.each(r, function(index,rObj) {
                            $('ul').append("<li>from: "+rObj.from_user+ " - "  +rObj.text+ "</li>");
                            var ent = rObj.entities;
                            var urls = ent.urls[0];
                            var img = "";
                            if(typeof urls!='undefined'){
                                //console.log(urls.expanded_url);
                                //fetch instagram image
                                var eUrl = urls.expanded_url;
                                if(eUrl.indexOf("instagr.am")!=-1){
                                    $.getJSON("http://api.instagram.com/oembed?url="+eUrl+"&callback=?",function(i){
                                        //console.log(index);
                                        $($('ul li')[index]).append("<br /><img src='"+i.url+"' />");
                                    });
                                }
                            }
                            
                        });
                    }
                });
            }
        });
    });
    </script>
</head>
<body>
    <ul>
        
    </ul>
</body>
</html>
